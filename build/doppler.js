window.doppler=function(){var a=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext,b=new a,c=b.createOscillator(),d=2e4,e=33,f=function(a,b){var c=g(a,d),f=b[c],h=.001,i=0;do{i++;var j=b[c-i],k=j/f}while(k>h&&e>i);var l=0;do{l++;var j=b[c+l],k=j/f}while(k>h&&e>l);return{left:i,right:l}},g=function(a,c){var d=b.sampleRate/2;return Math.round(c/d*a.fftSize/2)},h=function(a,c){var d=b.sampleRate/2;return d/(a.fftSize/2)*c},i=function(a,b,c,d){for(var e=a.frequency.value,f=new Uint8Array(b.frequencyBinCount),i=0,j=0,k=g(b,c),l=g(b,d),m=k;l>m;m++)a.frequency.value=h(b,m),b.getByteFrequencyData(f),f[m]>i&&(i=f[m],j=m);return 0==j?e:h(b,j)},j=0,k=function(a,b){var c=new Uint8Array(a.frequencyBinCount);a.getByteFrequencyData(c);var d=f(a,c);b(d),j=setTimeout(k,1,a,b)},l=function(a,e,f){var g=b.createMediaStreamSource(a),h=b.createAnalyser();h.smoothingTimeConstant=.5,h.fftSize=2048,g.connect(h),c.frequency.value=d,c.type=c.SINE,c.start(0),c.connect(b.destination),setTimeout(function(){d=i(c,h,19e3,22e3),c.frequency.value=d,clearInterval(j),e(h,f)})};return{init:function(a){navigator.getUserMedia_=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia_({audio:{optional:[{echoCancellation:!1}]}},function(b){l(b,k,a)},function(){console.log("Error!")})},stop:function(){clearInterval(j)}}}(window,document);